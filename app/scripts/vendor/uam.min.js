
/*
 * -------------------------------------------------------
 * Project: Universal Asset Manager
 * Version: 0.1.0
 *
 * Author:  jeffreyjw
 * Site:     https://github.com/jeffreyjw
 * Contact: jjwojtczak@gmail.com
 *
 *
 * Copyright (c) 2014 jeffreyjw
 * -------------------------------------------------------
 */

"use strict";var UAM;UAM=UAM||{},UAM.Asset=function(){function Asset(url,assetManager){this.assetManager=assetManager,this.url=url}return Asset.prototype.assetManager=null,Asset.prototype.data=null,Asset.prototype.url=null,Asset.prototype.done=function(){return this.assetManager._assetLoaded(this)},Asset.prototype.error=function(){return this.assetManager._raiseError(this)},Asset}(),UAM.AssetManager=function(){function AssetManager(config){this.config=config,this.assetTypes=config.assetTypes,this.assetsToLoad=config.assets,this.loadedAssets={},this.listeners={error:[],loaded:[],progress:[]}}return AssetManager.prototype.config=null,AssetManager.prototype.assetTypes=null,AssetManager.prototype.assetsToLoad=null,AssetManager.prototype.loadedAssets=null,AssetManager.prototype.assetsToLoadLength=0,AssetManager.prototype.loadedAssetsLength=0,AssetManager.prototype.listeners=null,AssetManager.prototype.addEventListener=function(event,callback){return this.listeners[event].push(callback)},AssetManager.prototype._callEventListeners=function(event,asset){var listener,_i,_len,_ref,_results;for(_ref=this.listeners[event],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)listener=_ref[_i],_results.push("error"!==event?listener(this.loadedAssetsLength,this.assetsToLoadLength):listener(asset.url));return _results},AssetManager.prototype.load=function(){var key,url,_i,_len,_ref,_results;this.assetsToLoadLength=0;for(key in this.assetsToLoad)for(_ref=this.assetsToLoad[key],_i=0,_len=_ref.length;_len>_i;_i++)url=_ref[_i],++this.assetsToLoadLength;if(0===this.assetsToLoadLength)return void this._callEventListeners("loaded",null);_results=[];for(key in this.assetsToLoad)_results.push(function(){var _j,_len1,_ref1,_results1;for(_ref1=this.assetsToLoad[key],_results1=[],_j=0,_len1=_ref1.length;_len1>_j;_j++)url=_ref1[_j],_results1.push(this.loadAsset(key,url));return _results1}.call(this));return _results},AssetManager.prototype.loadAsset=function(assetType,url){var asset;return url in this.loadedAssets?void 0:(asset=new UAM.Asset(url,this),this.assetTypes[assetType](url,asset))},AssetManager.prototype.get=function(url){var data;return data=null,url in this.loadedAssets&&(data=this.loadedAssets[url].data),data},AssetManager.prototype._assetLoaded=function(asset){return this.loadedAssets[asset.url]=asset,++this.loadedAssetsLength,this._callEventListeners("progress",asset),this.loadedAssetsLength===this.assetsToLoadLength?this._callEventListeners("loaded",asset):void 0},AssetManager.prototype._raiseError=function(asset){return this._callEventListeners("error",asset)},AssetManager}();